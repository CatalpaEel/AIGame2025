# 大信科活动规划与宣传智能系统

信息科学技术学院经常需要策划和举办各类学术讲座、科研竞赛、行业交流等活动。本系统借助Deepseek、豆包等大模型API，能够在一次性输入活动初步需求后，自动完成活动策划案、各种宣传稿以及主视觉的生成。

## 一、架构设计与Agent设计

系统总共有个Agent，可以分为输入分析、活动设计、历史文案设计、宣传文案生成、历史主视觉分析、主视觉生成六大模块。

<center>
    <img style="border-radius: 0.3125em;" src="workflow.drawio.png">
    <div style="color: #999;">系统整体架构与Agent分工</div>
</center>

### 1.输入分析

### 2.活动设计

### 3.历史文案分析

### 4.宣传文案生成

### 5.历史主视觉分析

对历史主视觉数据集进行分析，提炼大信科主视觉的艺术特点，从而增强主视觉生成的风格一致性。由于主视觉生成是基于提示词（prompt）的，因此提炼过去主视觉的特点，可直接通过“反推提示词”来实现。

所以，本模块的任务是，对数据集中每一个主视觉图片，经预处理后调用API，让大模型反推出生成该图片的可能的提示词，并储存下来备用。

### 6.主视觉生成

首先根据本次活动的特征以及历史主视觉分析得出的数据，使用Deepseek生成提示词，再根据提示词通过文生图模型生成主视觉。

## 二、API调用策略与参数设计

### 历史主视觉分析

由于需要输入图片并分析图片，我们使用了豆包的视觉理解大模型[doubao-1-5-vision-pro-32k-250115](https://www.volcengine.com/docs/82379/1494384)。调用方法为[OpenAI API](https://www.volcengine.com/docs/82379/1330626)。

豆包API在处理不同格式的图片（jpg、png）时有细微的差别，为了方便，我们先通过代码将数据集批量转化成了png格式。豆包还要求上传图片的大小不超过25M，超过这个大小的图片不多，于是我们使用Windows画图软件手动调整了大小。

在system prompt里，需强调中文输出与不输出多余信息，否则可能会生成英文提示词或带上“以下是可能的文生图提示词”的多余前缀。

```python
self.system_prompt = """
    请根据图片反推详细的中文文生图提示词，不要输出提示词外的多余信息
"""
```

### 文生图模型的选择

目前较为先进的开源文生图模型有Flux.1与StableDiffusion3.5等，但这两个模型都是基于英语训练的，极难做好对中文字符的生成。然而，主视觉的重要目的是传达核心信息，清晰明显的字体是主视觉可用性的重要保障，而英文标题的主视觉又不符合大信科的风格，因此中文字符生成的质量是模型选择的关键。总之，Flux.1与StableDiffusion3.5模型不适宜直接用作主视觉的生成。

于是，我们尝试在Flux.1的基础上添加ControlNet来实现中文字符的正确生成。首先使用Pillow库，设计文字坐标生成文字底图（textbase），然后将文字底图输入ControlNet，经过硬边缘预处理，提取出文字的轮廓，引导模型生成。

我们使用LiblibAI提供的[api接口](https://liblibai.feishu.cn/wiki/UAMVw67NcifQHukf8fpccgS5n6d#OU4KdR29zoAieyxj8EicICJ5nmg)，选择F.1-dev-fp8底模与InstantX-FLUX.1-dev-Controlnet-Union-Pro模型。最终，我们取得了一定的效果。

<div style="display:flex; gap:40px;">
    <center>
        <img src="image_flux.png">
        <div style="color: #999;">Flux.1生成的主视觉</div>
    </center>
    <center>
        <img src="image_controlnet.png">
        <div style="color: #999;">Flux.1+ControlNet</div>
    </center>
</div>

然而，这种方法有几个明显的缺点：1.调用Pillow库前，需要精准计算文字底图上文字的坐标，但大模型很难生成这样精准的坐标位置；2.底图经过预处理器后仅有文字边缘，导致除文字外的部分很难生成硬边缘，只能产生诸如水彩的模糊风格。3.字体有限，难以生成艺术字；4.较小的文字仍然会变形。

因此，我们最后转向一些国内的闭源模型。经测试，字节跳动的[通用2.1-文生图](https://www.volcengine.com/docs/6791/1366783)和[即梦V2.1文生图模型](https://www.volcengine.com/docs/85621/1537648)都有一定的中文字符生成能力。（实际上不确定这两个产品是否同一个模型。另外，3.0版本已经发布，可以在网页版使用，对中文字符的生成能力更佳，但API调用接口似乎并未开放。）我们最后使用的是即梦V2.1文生图模型，通过[火山引擎SDK](https://www.volcengine.com/docs/6444/1340578)调用。

## 三、风格分析与特征提取方法论

### 1.输入信息特征提取

### 2.主视觉数据集分析

## 四、性能优化与评估

## 五、质量评估与改进方向

## 六、参考资料

[LiblibAI文档](https://liblibai.feishu.cn/wiki/UAMVw67NcifQHukf8fpccgS5n6d)

[豆包通用2.1-文生图文档](https://www.volcengine.com/docs/6791/1366783)

[即梦V2.1文生图模型文档](https://www.volcengine.com/docs/85621/1537648)